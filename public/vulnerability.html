<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Vulnerability Analysis - BusBook Travel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="busbook.css">
    <style>
        .vulnerability-page {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .vulnerability-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .vulnerability-header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }
        
        .vulnerability-header h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .vulnerability-header .warning {
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            display: inline-block;
            font-weight: 600;
            margin-top: 1rem;
        }
        
        .vulnerability-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .vulnerability-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid #ef4444;
        }
        
        .vulnerability-card.critical {
            border-left-color: #dc2626;
        }
        
        .vulnerability-card.high {
            border-left-color: #ea580c;
        }
        
        .vulnerability-card.medium {
            border-left-color: #d97706;
        }
        
        .vulnerability-header-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .vulnerability-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .severity-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .severity-critical {
            background: #dc2626;
            color: white;
        }
        
        .severity-high {
            background: #ea580c;
            color: white;
        }
        
        .severity-medium {
            background: #d97706;
            color: white;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            margin: 1rem 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .exposed-data {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .exposed-data h4 {
            color: #dc2626;
            margin-bottom: 1rem;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }
        
        .data-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .password-reveal {
            color: #dc2626;
            font-weight: 600;
            background: #fef2f2;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        
        .overview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #dc2626;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .recommendations {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .recommendations h3 {
            color: #0c4a6e;
            margin-bottom: 1rem;
        }
        
        .recommendations ul {
            list-style: none;
            padding: 0;
        }
        
        .recommendations li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e0f2fe;
            display: flex;
            align-items: center;
        }
        
        .recommendations li:before {
            content: "✓";
            color: #059669;
            font-weight: bold;
            margin-right: 1rem;
        }
        
        .back-btn {
            background: white;
            color: #667eea;
            border: 2px solid white;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            text-decoration: none;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: transparent;
            color: white;
        }
    </style>
</head>
<body>
    <div class="vulnerability-page">
        <div class="vulnerability-container">
            <div class="vulnerability-header">
                <a href="/" class="back-btn">
                    <i class="fas fa-arrow-left"></i> Back to Home
                </a>
                <h1><i class="fas fa-shield-alt"></i> Security Vulnerability Analysis</h1>
                <p style="font-size: 1.2rem; opacity: 0.9;">Complete security assessment of BusBook Travel Platform</p>
                <div class="warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    CRITICAL VULNERABILITIES DETECTED - FOR EDUCATIONAL PURPOSES ONLY
                </div>
            </div>

            <!-- Loading message -->
            <div id="loading" style="text-align: center; color: white; font-size: 1.2rem;">
                <i class="fas fa-spinner fa-spin"></i> Analyzing security vulnerabilities...
            </div>

            <!-- Vulnerability content (will be populated by JavaScript) -->
            <div id="vulnerabilityContent" style="display: none;">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/vulnerability/analysis');
                const data = await response.json();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('vulnerabilityContent').style.display = 'block';
                
                renderVulnerabilityReport(data);
            } catch (error) {
                console.error('Failed to load vulnerability analysis:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: #fca5a5;">
                        <i class="fas fa-exclamation-circle"></i> 
                        Failed to load vulnerability analysis. Please ensure the application is running.
                    </div>
                `;
            }
        });

        function renderVulnerabilityReport(data) {
            const container = document.getElementById('vulnerabilityContent');
            
            container.innerHTML = `
                <!-- Overview Stats -->
                <div class="overview-stats">
                    <div class="stat-card">
                        <div class="stat-number">${data.overview.vulnerabilityCount}</div>
                        <div class="stat-label">Security Vulnerabilities</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.overview.affectedUsers}</div>
                        <div class="stat-label">Affected Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.overview.severity}</div>
                        <div class="stat-label">Severity Level</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.exposedData.creditCards.length}</div>
                        <div class="stat-label">Exposed Credit Cards</div>
                    </div>
                </div>

                <!-- Vulnerability Details -->
                <div class="vulnerability-grid">
                    ${data.codeVulnerabilities.map(vuln => `
                        <div class="vulnerability-card ${vuln.severity.toLowerCase()}">
                            <div class="vulnerability-header-card">
                                <div class="vulnerability-title">${vuln.type}</div>
                                <span class="severity-badge severity-${vuln.severity.toLowerCase()}">${vuln.severity}</span>
                            </div>
                            <p style="color: #64748b; margin-bottom: 1rem;">${vuln.description}</p>
                            <div style="margin-bottom: 1rem;">
                                <strong>Location:</strong> <code style="background: #f1f5f9; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">${vuln.location}</code>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <strong>Impact:</strong> ${vuln.impact}
                            </div>
                            <details style="margin-top: 1rem;">
                                <summary style="cursor: pointer; font-weight: 600; color: #1e293b;">View Code Example</summary>
                                <div class="code-block">${vuln.codeExample}</div>
                            </details>
                        </div>
                    `).join('')}
                </div>

                <!-- Exposed Data Section -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                    <!-- Exposed Passwords -->
                    <div class="exposed-data">
                        <h4><i class="fas fa-key"></i> Exposed User Passwords (Plain Text)</h4>
                        <p style="color: #dc2626; font-weight: 600; margin-bottom: 1rem;">
                            ⚠️ All user passwords are stored in plain text and visible in the database!
                        </p>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Password</th>
                                    <th>Role</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.exposedData.users.map(user => `
                                    <tr>
                                        <td>${user.email}</td>
                                        <td class="password-reveal">${user.plaintextPassword}</td>
                                        <td>${user.role}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <!-- Exposed Credit Cards -->
                    <div class="exposed-data">
                        <h4><i class="fas fa-credit-card"></i> Exposed Credit Card Information</h4>
                        <p style="color: #dc2626; font-weight: 600; margin-bottom: 1rem;">
                            ⚠️ Credit card details are stored without encryption!
                        </p>
                        ${data.exposedData.creditCards.length > 0 ? `
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Route</th>
                                        <th>Card Number</th>
                                        <th>CVV</th>
                                        <th>Expiry</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.exposedData.creditCards.map(card => `
                                        <tr>
                                            <td>${card.route}</td>
                                            <td class="password-reveal">${card.cardNumber}</td>
                                            <td class="password-reveal">${card.cvv}</td>
                                            <td>${card.expiryDate}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        ` : `
                            <p style="color: #6b7280;">No credit card bookings found yet. Make a booking to see how credit card data is exposed.</p>
                        `}
                    </div>
                </div>

                <!-- Security Recommendations -->
                <div class="recommendations">
                    <h3><i class="fas fa-shield-alt"></i> Security Recommendations</h3>
                    <ul>
                        ${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>

                <!-- Additional Info -->
                <div style="background: white; padding: 2rem; border-radius: 0.75rem; margin-top: 2rem; text-align: center;">
                    <h3 style="color: #1e293b; margin-bottom: 1rem;">How to Exploit These Vulnerabilities</h3>
                    <p style="color: #64748b; margin-bottom: 1.5rem;">
                        This analysis shows exactly where the security flaws exist in the code. 
                        Use this information to understand and fix the vulnerabilities.
                    </p>
                    <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                        <a href="/admin" class="btn btn-danger">
                            <i class="fas fa-user-shield"></i> Access Admin Panel (Vulnerable)
                        </a>
                        <a href="/dashboard" class="btn btn-primary">
                            <i class="fas fa-tachometer-alt"></i> User Dashboard
                        </a>
                        <a href="/" class="btn btn-outline">
                            <i class="fas fa-home"></i> Back to Home
                        </a>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
